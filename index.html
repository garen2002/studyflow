<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£—á–µ–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #6366f1, #9333ea);
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container { width: 100%; max-width: 480px; }
    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      margin-bottom: 10px;
    }
    h1, h2, h3 { text-align: center; margin-top: 0; }
    input, textarea, button { width: 100%; padding: 12px; margin-top: 10px; border-radius: 10px; border: 1px solid #ccc; font-size: 15px; }
    textarea { resize: none; overflow-y: auto; }
    button { background: #4f46e5; color: white; border: none; cursor: pointer; }
    button.secondary { background: #e5e7eb; color: #111; }
    .link { text-align:center; color:#4f46e5; cursor:pointer; margin-top:10px; }
    ul { padding-left: 20px; list-style: none; }
    li { background: #f3f4f6; padding: 8px; margin: 5px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
    .hidden { display: none; }
    .error { color: red; text-align: center; }
    @media(max-width: 480px){ .container{padding:0 10px;} }
  </style>
</head>
<body>
<div class="container">
  <div class="card" id="loginCard">
    <h1>üìö –£—á–µ–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</h1>
    <input id="email" placeholder="Email (–ª–æ–≥–∏–Ω)" />
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" />
    <input id="hint" placeholder="–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –ø–∞—Ä–æ–ª—è" />
    <button onclick="login()">–í–æ–π—Ç–∏ / –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <div class="link" onclick="showHint()">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</div>
    <p id="error" class="error"></p>
  </div>

  <div class="card hidden" id="app">
    <h2 id="welcome"></h2>

    <h3>üóì –ü–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å</h3>
    <input id="taskInput" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞" />
    <button onclick="addTask()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <ul id="taskList"></ul>

    <h3>‚úçÔ∏è –ö–æ–Ω—Å–ø–µ–∫—Ç</h3>
    <textarea id="notes" rows="10" placeholder="–ü–∏—à–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç..." oninput="autoGrow(this)"></textarea>

    <h3>üß† –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞</h3>
    <textarea id="answer" rows="6" placeholder="–¢–≤–æ–π –æ—Ç–≤–µ—Ç..." oninput="autoGrow(this)"></textarea>

    <button class="secondary" onclick="logout()">–í—ã–π—Ç–∏</button>
  </div>
</div>

<script>
  const loginCard = document.getElementById('loginCard');
  const app = document.getElementById('app');
  const welcome = document.getElementById('welcome');
  const error = document.getElementById('error');
  const taskList = document.getElementById('taskList');
  let currentUser = null;

  window.onload = () => {
    const savedUser = localStorage.getItem('currentUser');
    if(savedUser){ currentUser = savedUser; showApp(); loadData(); }
  };

  function login(){
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const hint = document.getElementById('hint').value.trim();
    if(!email || !password){ error.textContent='–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å'; return; }
    const users = JSON.parse(localStorage.getItem('users')) || {};
    if(users[email] && users[email].password!==password){ error.textContent='–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å'; return; }
    users[email]={password,hint};
    localStorage.setItem('users',JSON.stringify(users));
    localStorage.setItem('currentUser',email);
    currentUser=email; error.textContent=''; showApp(); loadData();
  }

  function showHint(){
    const email = document.getElementById('email').value.trim();
    const users = JSON.parse(localStorage.getItem('users')) || {};
    if(!users[email]){ error.textContent='–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω'; return; }
    error.textContent='–ü–æ–¥—Å–∫–∞–∑–∫–∞: '+(users[email].hint||'–Ω–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏');
  }

  function showApp(){ loginCard.classList.add('hidden'); app.classList.remove('hidden'); welcome.textContent='–ü—Ä–∏–≤–µ—Ç, '+currentUser+' üëã'; }

  function logout(){ localStorage.removeItem('currentUser'); location.reload(); }

  function addTask(){
    const input=document.getElementById('taskInput');
    if(!input.value) return;
    const data=getUserData();
    data.tasks.push({text:input.value, id:Date.now(), done:false});
    saveUserData(data); input.value=''; loadData();
  }

  function loadData(){
    const data=getUserData();
    taskList.innerHTML='';
    data.tasks.forEach(t=>{
      const li=document.createElement('li');
      li.innerHTML=`<span style='text-decoration:${t.done?'line-through':'none'}'>${t.text}</span>
        <div>
          <button onclick='editTask(${t.id})'>‚úèÔ∏è</button>
          <button onclick='toggleDone(${t.id})'>‚úÖ</button>
          <button onclick='deleteTask(${t.id})'>üóëÔ∏è</button>
        </div>`;
      taskList.appendChild(li);
    });
    document.getElementById('notes').value=data.notes; autoGrow(document.getElementById('notes'));
    document.getElementById('answer').value=data.answer; autoGrow(document.getElementById('answer'));
  }

  function editTask(id){
    const data=getUserData();
    const task=data.tasks.find(t=>t.id===id);
    const newText=prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É:',task.text);
    if(newText){ task.text=newText; saveUserData(data); loadData(); }
  }

  function deleteTask(id){
    const data=getUserData();
    data.tasks=data.tasks.filter(t=>t.id!==id);
    saveUserData(data); loadData();
  }

  function toggleDone(id){
    const data=getUserData();
    const task=data.tasks.find(t=>t.id===id);
    task.done=!task.done; saveUserData(data); loadData();
  }

  function getUserData(){
    const allData=JSON.parse(localStorage.getItem('data'))||{};
    if(!allData[currentUser]) allData[currentUser]={tasks:[],notes:'',answer:''};
    return allData[currentUser];
  }

  function saveUserData(update){
    const allData=JSON.parse(localStorage.getItem('data'))||{};
    allData[currentUser]=update;
    localStorage.setItem('data',JSON.stringify(allData));
  }

  document.getElementById('notes').addEventListener('input',e=>{
    const data=getUserData(); data.notes=e.target.value; saveUserData(data); autoGrow(e.target);
  });
  document.getElementById('answer').addEventListener('input',e=>{
    const data=getUserData(); data.answer=e.target.value; saveUserData(data); autoGrow(e.target);
  });

  function autoGrow(textarea){ textarea.style.height='auto'; textarea.style.height=(textarea.scrollHeight)+'px'; }
</script>
</body>
</html>